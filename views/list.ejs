<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="/main.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="grey-bg">

  <%- include('nav.ejs') %>

  <input type="text" name="" id="" class="search">
  <button class="search-send">ê²€ìƒ‰</button>


  <span><%= new Date() %></span>
  <div class="white-bg">
    <% for (let i = 0; i < ê¸€ëª©ë¡.length; i++){ %>
    <div class="list-box">
      <p>ì‘ì„±ì : <%= ê¸€ëª©ë¡[i].username %></p>
      <a href="/detail/<%= ê¸€ëª©ë¡[i]._id %>"><%= ê¸€ëª©ë¡[i].title %>
        <a href="/edit/<%= ê¸€ëª©ë¡[i]._id %>">âœï¸</a>      
        <span data-id="<%= ê¸€ëª©ë¡[i]._id %>" class="delete">ğŸ—‘ï¸</span>
      </a>
      <p><%= ê¸€ëª©ë¡[i].content %></p>
    </div>
    <% } %>
  </div> 
  
<script>
  document.querySelector('.search-send').addEventListener('click', function(){
    let ì…ë ¥í•œê±° = document.querySelector('.search').value
    location.href = '/search?val=' + ì…ë ¥í•œê±°
  })
</script>
<script>
  document.querySelectorAll('.delete').forEach((item, i)=>{
    item.addEventListener('click', function(e){
      e.preventDefault();

      // ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡ 1. ajax (axios ë¼ì´ë¸ŒëŸ¬ë¦¬) 2. query string 3. url
      // fetch('/abc?ë°ì´í„°ì´ë¦„=ë°ì´í„°ê°’&ë°ì´í„°ì´ë¦„=ë°ì´í„°ê°’') => query string  ...consolog.log(req.query.ë°ì´í„°ì´ë¦„)
      // fetch('/abc/parkyangji') => url
      // urlë¡œ ì •ë³´ìœ ì¶œ
      fetch('/delete?id=' + e.target.dataset.id, {
        method : 'DELETE'
      })
      .then((r)=>r.text())
      .then((r)=>{console.log(r) // ì‚­ì œì™„ë£Œ
          // htmlì„ ë³´ì—¬ì£¼ëŠ” ë²• 
          // 1. ì„œë²„ì—ì„œ ë‹¤ ë§Œë“¤ì–´ì„œ ë³´ë‚´ê¸°(ì„œë²„ì‚¬ì´ë“œëœë”ë§) 
          // 2. ì„œë²„ëŠ” ë°ì´í„°ë§Œ ë³´ë‚´ê³  ë¸Œë¼ìš°ì €ì—ì„œ ì™„ì„±í•˜ê¸° (í´ë¼ì´ì–¸íŠ¸ì‚¬ì´ë“œë Œë”ë§)
          item.parentElement.style.display = 'none';
      }) 
    })
  })

  /*
  fetch('/URL')
    .then((r)=>{
      if (r.status == 200) {
        return r.json()
      } else {
        // ì„œë²„ê°€ ì—ëŸ¬ì½”ë“œ ì „ì†¡ì‹œ ì‹¤í–‰í•  ì½”ë“œ
      }
    })
    .then((result)=>{
      // ì„±ê³µì‹œ ì‹¤í–‰í•  ì½”ë“œ
    }).catch((err)=>{
      // ì¸í„°ë„· ë¬¸ì œ ë“±ìœ¼ë¡œ ì‹¤íŒ¨ì‹œ ì‹¤í–‰í•  ì½”ë“œ
      console.log(err)
    })
  */
</script>
</body>
</html>